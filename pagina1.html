<!-- pagina1.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de seguimiento de prácticas profesionales para la Facultad de Ingenierías - Universidad de Aconcagua">
    <title>Seguimiento de Prácticas - Facultad de Ingenierías | UAC</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Flatpickr -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <!-- Estilos personalizados -->
    <style>
        :root {
            --primary-color: #00204e;
            --primary-light: #173b6c;
            --secondary-color: #FFA500;
            --accent-color: #ff8c00;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --muted-text: #6c757d;
            
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            
            --border-radius: 10px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            padding: 0;
            margin: 0;
        }
        
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .page-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            padding: 2.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .content-wrapper {
            margin: 2rem auto;
        }
        
        /* Card de estudiante */
        .student-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: var(--transition);
            border: none;
        }
        
        .student-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-3px);
        }
        
        .student-card .card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .student-card .card-body {
            padding: 1.5rem;
        }
        
        .student-info {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .student-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--primary-color);
        }
        
        .student-details {
            flex: 1;
        }
        
        .student-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--primary-color);
        }
        
        .student-id {
            font-size: 1rem;
            color: var(--muted-text);
            margin-bottom: 0.5rem;
        }
        
        .student-career, .student-campus {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }
        
        .progress-section {
            margin-top: 1.5rem;
        }
        
        .progress-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
        }
        
        .stage-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .stage-not-started {
            background-color: #f8d7da;
            color: var(--danger-color);
        }
        
        .stage-in-progress {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .stage-completed {
            background-color: #d4edda;
            color: var(--success-color);
        }
        
        .status-not-started { color: var(--danger-color); }
        .status-in-progress { color: var(--warning-color); }
        .status-completed { color: var(--success-color); }
        
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .action-buttons .btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .btn-edit {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .btn-edit:hover {
            background-color: var(--primary-light);
            color: white;
        }
        
        .btn-document {
            background-color: var(--secondary-color);
            color: white;
            border: none;
        }
        
        .btn-document:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        /* Filtros y búsqueda */
        .filters-section {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box .form-control {
            padding-left: 40px;
            height: 45px;
            border-radius: 50px;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted-text);
        }
        
        .filter-tag {
            display: inline-flex;
            align-items: center;
            background-color: var(--primary-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            font-size: 0.85rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .filter-tag .close {
            margin-left: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        /* Stats cards */
        .stats-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            text-align: center;
            height: 100%;
            transition: var(--transition);
            border: none;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
        }
        
        .stats-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .stats-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .stats-label {
            font-size: 1rem;
            color: var(--muted-text);
            margin-bottom: 0.75rem;
        }
        
        .stats-progress {
            height: 8px;
            margin-top: 1rem;
            border-radius: 4px;
        }
        
        /* Modal de edición */
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .form-section {
            margin-bottom: 1.5rem;
        }
        
        .form-section-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 0.5rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        
        .pagination .page-link {
            color: var(--primary-color);
            border-radius: 5px;
            margin: 0 3px;
        }
        
        .pagination .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        /* Footer */
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem 0;
            margin-top: 3rem;
        }
        
        /* Tooltip y Popovers */
        .tooltip-inner {
            max-width: 250px;
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            font-size: 0.875rem;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Ajustes responsivos */
        @media (max-width: 992px) {
            .student-card .card-body {
                padding: 1.25rem;
            }
            
            .student-photo {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .student-name {
                font-size: 1.3rem;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .action-buttons .btn {
                width: 100%;
                justify-content: center;
                margin-bottom: 0.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .student-info {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 1rem;
            }
            
            .student-details {
                width: 100%;
            }
            
            .filters-section .row {
                flex-direction: column;
            }
            
            .filter-dropdown {
                margin-bottom: 1rem;
            }
        }
        
        /* Nota final */
        .final-grade {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 0.4rem 0.75rem;
            display: inline-block;
            margin-top: 0.5rem;
        }
        
        .final-grade.high {
            color: var(--success-color);
        }
        
        .final-grade.medium {
            color: var(--warning-color);
        }
        
        .final-grade.low {
            color: var(--danger-color);
        }
        
        /* Fix para select2 en modales */
        .select2-container--bootstrap-5 {
            z-index: 1056 !important;
        }
        
        /* Estilos para la vista previa de gráficos */
        .chart-preview-container {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .chart-preview-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .chart-canvas-container {
            height: 200px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-university me-2"></i>Seguimiento Prácticas UAC
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">
                            <i class="fas fa-home me-1"></i> Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <button id="logoutBtn" class="btn btn-danger ms-2">
                            <i class="fas fa-sign-out-alt me-1"></i> Cerrar Sesión
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header class="page-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-cogs me-2"></i> Seguimiento de Prácticas</h1>
                    <p class="lead">Facultad de Ingenierías, Tecnologías e Innovación</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <a href="index.html" id="volverPrincipal" class="btn btn-light">
                        <i class="fas fa-arrow-left me-1"></i> Volver al Menú
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container content-wrapper">
        <!-- Estadísticas generales -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="mb-4"><i class="fas fa-chart-simple me-2"></i> Estadísticas Generales</h2>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="stats-card">
                    <div class="stats-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stats-value" id="totalStudentsValue">0</div>
                    <div class="stats-label">Estudiantes en Prácticas</div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="stats-card">
                    <div class="stats-icon text-warning">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="stats-value text-warning" id="inProgressValue">0</div>
                    <div class="stats-label">En Proceso</div>
                    <div class="progress stats-progress">
                        <div class="progress-bar bg-warning" id="inProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="stats-card">
                    <div class="stats-icon text-success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stats-value text-success" id="completedValue">0</div>
                    <div class="stats-label">Completadas</div>
                    <div class="progress stats-progress">
                        <div class="progress-bar bg-success" id="completedBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="stats-card">
                    <div class="stats-icon text-danger">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stats-value text-danger" id="pendingValue">0</div>
                    <div class="stats-label">Pendientes</div>
                    <div class="progress stats-progress">
                        <div class="progress-bar bg-danger" id="pendingBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Botones de acción generales -->
            <div class="col-12 text-center mt-2 mb-4">
                <button id="generateReportBtn" class="btn btn-primary me-2">
                    <i class="fas fa-file-pdf me-1"></i> Generar Informe Completo
                </button>
                <button id="exportExcelBtn" class="btn btn-success me-2">
                    <i class="fas fa-file-excel me-1"></i> Exportar a Excel
                </button>
                <button id="addStudentBtn" class="btn btn-secondary">
                    <i class="fas fa-user-plus me-1"></i> Agregar Estudiante
                </button>
            </div>
        </div>
        
        <!-- Filtros y búsqueda -->
        <div class="filters-section">
            <div class="row">
                <div class="col-md-6">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchStudent" class="form-control" placeholder="Buscar por nombre, RUT o centro de práctica...">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-6 mb-2 mb-md-0">
                            <select id="filterCareer" class="form-select filter-dropdown">
                                <option value="">Todas las carreras</option>
                                <!-- Las opciones se cargarán dinámicamente -->
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select id="filterStatus" class="form-select filter-dropdown">
                                <option value="">Todos los estados</option>
                                <option value="no-comienza">Pendiente</option>
                                <option value="en-proceso">En proceso</option>
                                <option value="completada">Completada</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-3" id="activeFilters">
                <!-- Etiquetas de filtros activos se cargarán aquí -->
                <!-- <span class="filter-tag">Carrera: Técnico en Minas <i class="fas fa-times close"></i></span> -->
            </div>
        </div>
        
        <!-- Listado de estudiantes -->
        <div id="studentsList" class="mt-4">
            <!-- Las tarjetas se generarán dinámicamente -->
        </div>
        
        <!-- Paginación -->
        <div class="pagination-container">
            <nav aria-label="Navegación de páginas">
                <ul class="pagination" id="pagination">
                    <!-- La paginación se generará dinámicamente -->
                </ul>
            </nav>
        </div>
    </main>

    <!-- Modal para editar estudiante -->
    <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editStudentModalLabel">Editar Información del Estudiante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="editStudentForm">
                        <input type="hidden" id="studentId">
                        
                        <!-- Información personal -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-user me-2"></i>Información Personal</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="studentName" class="form-label">Nombre completo</label>
                                    <input type="text" class="form-control" id="studentName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="studentRut" class="form-label">RUT</label>
                                    <input type="text" class="form-control" id="studentRut" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="studentCareer" class="form-label">Carrera</label>
                                    <select class="form-select" id="studentCareer" required>
                                        <!-- Las opciones se cargarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="studentCampus" class="form-label">Sede</label>
                                    <select class="form-select" id="studentCampus" required>
                                        <!-- Las opciones se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Información de práctica -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-building me-2"></i>Información de Práctica</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="practiceSupervisor" class="form-label">Encargado práctica UAC</label>
                                    <input type="text" class="form-control" id="practiceSupervisor" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="practiceCenter" class="form-label">Centro de práctica</label>
                                    <input type="text" class="form-control" id="practiceCenter" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="practiceInstructor" class="form-label">Instructor</label>
                                    <input type="text" class="form-control" id="practiceInstructor" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="practiceState" class="form-label">Estado de la práctica</label>
                                    <select class="form-select" id="practiceState" required>
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="startDate" class="form-label">Fecha de inicio</label>
                                    <input type="text" class="form-control datepicker" id="startDate">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="endDate" class="form-label">Fecha de término</label>
                                    <input type="text" class="form-control datepicker" id="endDate">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Seguimiento y evaluación -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-tasks me-2"></i>Seguimiento y Evaluación</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tracking1" class="form-label">Seguimiento 1</label>
                                    <select class="form-select" id="tracking1">
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="partialEvaluation" class="form-label">Evaluación parcial</label>
                                    <select class="form-select" id="partialEvaluation">
                                        <option value="excelente">Excelente</option>
                                        <option value="bien">Bien</option>
                                        <option value="suficiente">Suficiente</option>
                                        <option value="deficiente">Deficiente</option>
                                        <option value="malo">Malo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tracking2" class="form-label">Seguimiento 2</label>
                                    <select class="form-select" id="tracking2">
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="progressReview" class="form-label">Revisión de avance</label>
                                    <select class="form-select" id="progressReview">
                                        <option value="excelente">Excelente</option>
                                        <option value="bien">Bien</option>
                                        <option value="suficiente">Suficiente</option>
                                        <option value="deficiente">Deficiente</option>
                                        <option value="malo">Malo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="instructorEvaluation" class="form-label">Evaluación instructor</label>
                                    <select class="form-select" id="instructorEvaluation">
                                        <option value="excelente">Excelente</option>
                                        <option value="bien">Bien</option>
                                        <option value="suficiente">Suficiente</option>
                                        <option value="deficiente">Deficiente</option>
                                        <option value="malo">Malo</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="examAssignment" class="form-label">Asignación hora examen</label>
                                    <select class="form-select" id="examAssignment">
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="finalGrade" class="form-label">Nota Final (1.0 - 7.0)</label>
                                    <input type="number" class="form-control" id="finalGrade" min="1.0" max="7.0" step="0.1" value="4.0">
                                    <div class="form-text">Ingrese la calificación final del estudiante en escala de 1.0 a 7.0</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Documentación -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-file-alt me-2"></i>Documentación</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Documentación instructor</label>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="instructorDoc">
                                        <button class="btn btn-outline-secondary" type="button" id="viewInstructorDoc" disabled>
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Documentación finalización</label>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="completionDoc">
                                        <button class="btn btn-outline-secondary" type="button" id="viewCompletionDoc" disabled>
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-danger me-2" id="deleteStudentBtn">
                                <i class="fas fa-trash-alt me-1"></i> Eliminar Estudiante
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar estudiante -->
    <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addStudentModalLabel">Agregar Nuevo Estudiante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="addStudentForm">
                        <!-- Información personal -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-user me-2"></i>Información Personal</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newStudentName" class="form-label">Nombre completo</label>
                                    <input type="text" class="form-control" id="newStudentName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newStudentRut" class="form-label">RUT</label>
                                    <input type="text" class="form-control" id="newStudentRut" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newStudentCareer" class="form-label">Carrera</label>
                                    <select class="form-select" id="newStudentCareer" required>
                                        <!-- Las opciones se cargarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newStudentCampus" class="form-label">Sede</label>
                                    <select class="form-select" id="newStudentCampus" required>
                                        <!-- Las opciones se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Información de práctica -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-building me-2"></i>Información de Práctica</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newPracticeSupervisor" class="form-label">Encargado práctica UAC</label>
                                    <input type="text" class="form-control" id="newPracticeSupervisor" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newPracticeCenter" class="form-label">Centro de práctica</label>
                                    <input type="text" class="form-control" id="newPracticeCenter" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newPracticeInstructor" class="form-label">Instructor</label>
                                    <input type="text" class="form-control" id="newPracticeInstructor" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newPracticeState" class="form-label">Estado de la práctica</label>
                                    <select class="form-select" id="newPracticeState" required>
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newStartDate" class="form-label">Fecha de inicio</label>
                                    <input type="text" class="form-control datepicker" id="newStartDate">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newEndDate" class="form-label">Fecha de término</label>
                                    <input type="text" class="form-control datepicker" id="newEndDate">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Seguimiento y evaluación -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-tasks me-2"></i>Seguimiento y Evaluación</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newTracking1" class="form-label">Seguimiento 1</label>
                                    <select class="form-select" id="newTracking1">
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newPartialEvaluation" class="form-label">Evaluación parcial</label>
                                    <select class="form-select" id="newPartialEvaluation">
                                        <option value="excelente">Excelente</option>
                                        <option value="bien">Bien</option>
                                        <option value="suficiente">Suficiente</option>
                                        <option value="deficiente">Deficiente</option>
                                        <option value="malo">Malo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newTracking2" class="form-label">Seguimiento 2</label>
                                    <select class="form-select" id="newTracking2">
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newProgressReview" class="form-label">Revisión de avance</label>
                                    <select class="form-select" id="newProgressReview">
                                        <option value="excelente">Excelente</option>
                                        <option value="bien">Bien</option>
                                        <option value="suficiente">Suficiente</option>
                                        <option value="deficiente">Deficiente</option>
                                        <option value="malo">Malo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newInstructorEvaluation" class="form-label">Evaluación instructor</label>
                                    <select class="form-select" id="newInstructorEvaluation">
                                        <option value="excelente">Excelente</option>
                                        <option value="bien">Bien</option>
                                        <option value="suficiente">Suficiente</option>
                                        <option value="deficiente">Deficiente</option>
                                        <option value="malo">Malo</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="newExamAssignment" class="form-label">Asignación hora examen</label>
                                    <select class="form-select" id="newExamAssignment">
                                        <option value="no-comienza">No comienza</option>
                                        <option value="en-proceso">En proceso</option>
                                        <option value="completada">Completada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="newFinalGrade" class="form-label">Nota Final (1.0 - 7.0)</label>
                                    <input type="number" class="form-control" id="newFinalGrade" min="1.0" max="7.0" step="0.1" value="4.0">
                                    <div class="form-text">Ingrese la calificación final del estudiante en escala de 1.0 a 7.0</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Documentación -->
                        <div class="form-section">
                            <h5 class="form-section-title"><i class="fas fa-file-alt me-2"></i>Documentación</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Documentación instructor</label>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="newInstructorDoc">
                                        <button class="btn btn-outline-secondary" type="button" disabled>
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Documentación finalización</label>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="newCompletionDoc">
                                        <button class="btn btn-outline-secondary" type="button" disabled>
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para documentos -->
    <div class="modal fade" id="documentModal" tabindex="-1" aria-labelledby="documentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="documentModalLabel">Documentación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div id="documentViewer" class="text-center">
                        <!-- El contenido se generará dinámicamente -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <a id="downloadDocumentBtn" href="#" class="btn btn-primary">
                        <i class="fas fa-download me-1"></i> Descargar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar estudiante -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Confirmar eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p><i class="fas fa-exclamation-triangle text-danger me-2"></i> ¿Está seguro que desea eliminar a este estudiante?</p>
                    <p class="fw-bold" id="studentToDeleteName"></p>
                    <p>Esta acción no se puede deshacer.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="fas fa-trash-alt me-1"></i> Eliminar definitivamente
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de previsualización de informe -->
    <div class="modal fade" id="reportPreviewModal" tabindex="-1" aria-labelledby="reportPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportPreviewModalLabel">Vista previa del informe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 mb-4 text-center">
                            <h3>Informe de Seguimiento de Prácticas</h3>
                            <p class="lead">Facultad de Ingenierías, Tecnologías e Innovación</p>
                            <p class="text-muted">Generado: <span id="reportDate"></span></p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-preview-container">
                                <h5 class="chart-preview-title">Distribución por Estado</h5>
                                <div class="chart-canvas-container">
                                    <canvas id="previewStatusChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-preview-container">
                                <h5 class="chart-preview-title">Distribución por Sedes</h5>
                                <div class="chart-canvas-container">
                                    <canvas id="previewCampusChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-preview-container">
                                <h5 class="chart-preview-title">Distribución por Carreras</h5>
                                <div class="chart-canvas-container">
                                    <canvas id="previewCareerChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-preview-container">
                                <h5 class="chart-preview-title">Evaluación del Instructor</h5>
                                <div class="chart-canvas-container">
                                    <canvas id="previewEvaluationChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-preview-container">
                                <h5 class="chart-preview-title">Distribución de Notas Finales</h5>
                                <div class="chart-canvas-container">
                                    <canvas id="previewGradesChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-preview-container">
                                <h5 class="chart-preview-title">Estadísticas Generales</h5>
                                <div class="p-3">
                                    <div id="previewStatsContent"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="generateFinalReportBtn">
                        <i class="fas fa-file-pdf me-1"></i> Generar PDF Final
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">© 2025 Universidad de Aconcagua</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Coordinación de Centros de Prácticas e Inserción Laboral</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Datos de carreras y sedes
        const carreras = [
            'Técnico De Nivel Superior En Administración De Empresas',
            'Técnico De Nivel Superior En Agronomía',
            'Técnico De Nivel Superior En Automatización Y Control Industrial',
            'Técnico De Nivel Superior En Construcción',
            'Técnico De Nivel Superior En Electricidad',
            'Técnico De Nivel Superior En Mantenimiento Industrial',
            'Técnico De Nivel Superior En Mecánica Industrial',
            'Técnico De Nivel Superior En Minas',
            'Técnico De Nivel Superior En Minería Y Metalurgia',
            'Técnico Nivel Superior En Construcción Y Obras Civiles'
        ];

        const sedes = ['Ancud', 'Calama', 'Los Andes', 'San Felipe', 'Machali'];
        
        // Datos de estudiantes y estado global
        let studentsData = [];
        let currentPage = 1;
        const studentsPerPage = 5;
        let totalPages = 0;
        let activeFilters = {
            search: '',
            career: '',
            status: ''
        };
        
        // Variable para almacenar el ID del estudiante a eliminar
        let studentIdToDelete = null;
        
        // Variables para gráficos del informe
        let statusChart, campusChart, careerChart, evaluationChart, gradesChart;

        // Función para obtener el encargado de práctica según carrera y sede
        function obtenerEncargadoPractica(carrera, sede) {
            if (carrera === 'Técnico De Nivel Superior En Agronomía' && sede === 'San Felipe') {
                return 'Julio Guzmán';
            } else if (carrera !== 'Técnico De Nivel Superior En Agronomía' && sede === 'Los Andes') {
                return 'Arturo Montenegro';
            } else if (carrera !== 'Técnico De Nivel Superior En Agronomía' && sede === 'Calama') {
                return 'Director carrera Calama';
            } else if (['Machali', 'Ancud'].includes(sede)) {
                return 'Define director/a académica';
            } else {
                return '';
            }
        }

        // Función para cargar los datos de estudiantes
        function loadStudentsData() {
            const savedData = JSON.parse(localStorage.getItem('datosPracticas')) || [];
            studentsData = savedData.map((student, index) => {
                return {
                    id: index,
                    nombre: student.nombre || '',
                    rut: student.rut || '',
                    carrera: student.carrera || carreras[0],
                    sede: student.sede || sedes[0],
                    encargadoPractica: student.encargadoPractica || obtenerEncargadoPractica(student.carrera, student.sede),
                    centroPractica: student.centroPractica || '',
                    instructor: student.instructor || '',
                    fechaInicio: student.fechaInicio || '',
                    fechaTermino: student.fechaTermino || '',
                    seguimiento1: student.seguimiento1 || 'no-comienza',
                    evaluacionParcial: student.evaluacionParcial || 'excelente',
                    seguimiento2: student.seguimiento2 || 'no-comienza',
                    revisionAvance: student.revisionAvance || 'excelente',
                    evaluacionInstructor: student.evaluacionInstructor || 'excelente',
                    documentoInstructor: false, // Este campo requeriría almacenamiento de archivos real
                    finalizacionPractica: student.finalizacionPractica || 'no-comienza',
                    documentoFinalizacion: false, // Este campo requeriría almacenamiento de archivos real
                    asignacionHoraExamen: student.asignacionHoraExamen || 'no-comienza',
                    notaFinal: student.notaFinal || 4.0 // Nota final por defecto
                };
            }).filter(student => student.nombre.trim() !== ''); // Filtrar estudiantes sin nombre
            
            updateStatistics();
            renderStudentsList();
        }

        // Función para filtrar estudiantes según los criterios activos
        function filterStudents() {
            return studentsData.filter(student => {
                // Filtro por búsqueda
                const searchMatch = !activeFilters.search || 
                    student.nombre.toLowerCase().includes(activeFilters.search.toLowerCase()) ||
                    student.rut.toLowerCase().includes(activeFilters.search.toLowerCase()) ||
                    student.centroPractica.toLowerCase().includes(activeFilters.search.toLowerCase());
                
                // Filtro por carrera
                const careerMatch = !activeFilters.career || student.carrera === activeFilters.career;
                
                // Filtro por estado
                const statusMatch = !activeFilters.status || student.finalizacionPractica === activeFilters.status;
                
                return searchMatch && careerMatch && statusMatch;
            });
        }

        // Función para renderizar la lista de estudiantes con paginación
        function renderStudentsList() {
            const filteredStudents = filterStudents();
            totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            
            // Asegurar que la página actual es válida
            if (currentPage > totalPages) {
                currentPage = totalPages > 0 ? totalPages : 1;
            }
            
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = startIndex + studentsPerPage;
            const currentStudents = filteredStudents.slice(startIndex, endIndex);
            
            const studentsList = document.getElementById('studentsList');
            studentsList.innerHTML = '';
            
            if (currentStudents.length === 0) {
                studentsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No se encontraron estudiantes</h4>
                        <p>Intenta con otros criterios de búsqueda o agrega nuevos estudiantes.</p>
                    </div>
                `;
                return;
            }
            
            currentStudents.forEach(student => {
                // Calcular progreso
                const stagesCompleted = [
                    student.seguimiento1 === 'completada',
                    student.evaluacionParcial !== '',
                    student.seguimiento2 === 'completada',
                    student.revisionAvance !== '',
                    student.evaluacionInstructor !== '',
                    student.documentoInstructor,
                    student.finalizacionPractica === 'completada',
                    student.documentoFinalizacion,
                    student.asignacionHoraExamen === 'completada'
                ].filter(Boolean).length;
                
                const progress = Math.round((stagesCompleted / 9) * 100);
                
                // Determinar estado global para color de progreso
                let statusClass = 'bg-danger';
                if (student.finalizacionPractica === 'completada') {
                    statusClass = 'bg-success';
                } else if (student.finalizacionPractica === 'en-proceso') {
                    statusClass = 'bg-warning';
                }
                
                // Crear etiqueta de estado
                let statusBadge = '';
                if (student.finalizacionPractica === 'no-comienza') {
                    statusBadge = `<span class="stage-badge stage-not-started">Pendiente</span>`;
                } else if (student.finalizacionPractica === 'en-proceso') {
                    statusBadge = `<span class="stage-badge stage-in-progress">En proceso</span>`;
                } else {
                    statusBadge = `<span class="stage-badge stage-completed">Completada</span>`;
                }
                
                // Crear iniciales para foto
                const initials = student.nombre
                    .split(' ')
                    .map(name => name.charAt(0))
                    .join('')
                    .substring(0, 2)
                    .toUpperCase();
                
                // Determinar clase para la nota final
                let gradeClass = '';
                if (student.notaFinal >= 6.0) {
                    gradeClass = 'high';
                } else if (student.notaFinal >= 4.0) {
                    gradeClass = 'medium';
                } else {
                    gradeClass = 'low';
                }
                
                // Renderizar tarjeta
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="card-header">
                        <span>Estudiante #${student.id + 1}</span>
                        ${statusBadge}
                    </div>
                    <div class="card-body">
                        <div class="student-info">
                            <div class="student-photo">
                                ${initials}
                            </div>
                            <div class="student-details">
                                <div class="student-name">${student.nombre}</div>
                                <div class="student-id">RUT: ${student.rut}</div>
                                <div class="student-career"><strong>Carrera:</strong> ${student.carrera}</div>
                                <div class="student-campus"><strong>Sede:</strong> ${student.sede}</div>
                                <div class="mt-2">
                                    <strong>Centro de práctica:</strong> ${student.centroPractica || 'No asignado'}
                                </div>
                                <div class="final-grade ${gradeClass}">
                                    <i class="fas fa-graduation-cap me-1"></i> Nota Final: ${student.notaFinal}
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-section">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="progress-title">Progreso de la práctica</span>
                                <span>${progress}%</span>
                            </div>
                            <div class="progress mb-3">
                                <div class="progress-bar ${statusClass}" role="progressbar" style="width: ${progress}%" 
                                    aria-valuenow="${progress}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <small>Seguimiento 1: <span class="status-${student.seguimiento1}">
                                        ${student.seguimiento1 === 'no-comienza' ? 'Pendiente' : 
                                          student.seguimiento1 === 'en-proceso' ? 'En proceso' : 'Completado'}
                                    </span></small>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <small>Seguimiento 2: <span class="status-${student.seguimiento2}">
                                        ${student.seguimiento2 === 'no-comienza' ? 'Pendiente' : 
                                          student.seguimiento2 === 'en-proceso' ? 'En proceso' : 'Completado'}
                                    </span></small>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <small>Evaluación: <strong>${student.evaluacionInstructor.charAt(0).toUpperCase() + student.evaluacionInstructor.slice(1)}</strong></small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-edit edit-student" data-id="${student.id}">
                                <i class="fas fa-edit"></i> Editar información
                            </button>
                            <button class="btn btn-document upload-document" data-id="${student.id}" data-type="instructor">
                                <i class="fas fa-file-upload"></i> Documentación instructor
                            </button>
                            <button class="btn btn-document upload-document" data-id="${student.id}" data-type="completion">
                                <i class="fas fa-file-upload"></i> Documentación finalización
                            </button>
                        </div>
                    </div>
                `;
                
                studentsList.appendChild(card);
            });
            
            renderPagination();
        }

        // Función para renderizar la paginación
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            // Botón anterior
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `
                <a class="page-link" href="#" aria-label="Anterior">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            `;
            if (currentPage > 1) {
                prevLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage--;
                    renderStudentsList();
                });
            }
            pagination.appendChild(prevLi);
            
            // Páginas
            const maxPagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            const endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            
            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                pageLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = i;
                    renderStudentsList();
                });
                pagination.appendChild(pageLi);
            }
            
            // Botón siguiente
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `
                <a class="page-link" href="#" aria-label="Siguiente">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            `;
            if (currentPage < totalPages) {
                nextLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage++;
                    renderStudentsList();
                });
            }
            pagination.appendChild(nextLi);
        }

        // Función para actualizar las estadísticas
        function updateStatistics() {
            let totalStudents = studentsData.length;
            let inProgress = 0;
            let completed = 0;
            let pending = 0;
            
            studentsData.forEach(student => {
                if (student.finalizacionPractica === 'en-proceso') {
                    inProgress++;
                } else if (student.finalizacionPractica === 'completada') {
                    completed++;
                } else {
                    pending++;
                }
            });
            
            // Actualizar números
            document.getElementById('totalStudentsValue').textContent = totalStudents;
            document.getElementById('inProgressValue').textContent = inProgress;
            document.getElementById('completedValue').textContent = completed;
            document.getElementById('pendingValue').textContent = pending;
            
            // Actualizar barras de progreso
            document.getElementById('inProgressBar').style.width = totalStudents ? `${(inProgress / totalStudents) * 100}%` : '0%';
            document.getElementById('completedBar').style.width = totalStudents ? `${(completed / totalStudents) * 100}%` : '0%';
            document.getElementById('pendingBar').style.width = totalStudents ? `${(pending / totalStudents) * 100}%` : '0%';
            
            // Actualizar opciones de filtro
            const filterCareer = document.getElementById('filterCareer');
            filterCareer.innerHTML = '<option value="">Todas las carreras</option>';
            
            // Crear un conjunto de carreras únicas
            const uniqueCareers = [...new Set(studentsData.map(student => student.carrera))];
            uniqueCareers.forEach(career => {
                const option = document.createElement('option');
                option.value = career;
                option.textContent = career;
                filterCareer.appendChild(option);
            });
        }

        // Función para llenar select con opciones
        function fillSelectOptions(selectElement, options, selectedValue = '') {
            selectElement.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                if (option === selectedValue) {
                    optionElement.selected = true;
                }
                selectElement.appendChild(optionElement);
            });
        }

        // Función para llenar el modal de edición
        function fillEditModal(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;
            
            document.getElementById('studentId').value = student.id;
            document.getElementById('studentName').value = student.nombre;
            document.getElementById('studentRut').value = student.rut;
            
            // Llenar select de carreras
            fillSelectOptions(document.getElementById('studentCareer'), carreras, student.carrera);
            
            // Llenar select de sedes
            fillSelectOptions(document.getElementById('studentCampus'), sedes, student.sede);
            
            // Información de práctica
            document.getElementById('practiceSupervisor').value = student.encargadoPractica;
            document.getElementById('practiceCenter').value = student.centroPractica;
            document.getElementById('practiceInstructor').value = student.instructor;
            document.getElementById('practiceState').value = student.finalizacionPractica;
            document.getElementById('startDate').value = student.fechaInicio;
            document.getElementById('endDate').value = student.fechaTermino;
            
            // Seguimiento y evaluación
            document.getElementById('tracking1').value = student.seguimiento1;
            document.getElementById('partialEvaluation').value = student.evaluacionParcial;
            document.getElementById('tracking2').value = student.seguimiento2;
            document.getElementById('progressReview').value = student.revisionAvance;
            document.getElementById('instructorEvaluation').value = student.evaluacionInstructor;
            document.getElementById('examAssignment').value = student.asignacionHoraExamen;
            document.getElementById('finalGrade').value = student.notaFinal;
            
            // Documentación - Aquí se manejaría la visualización de archivos existentes
            const viewInstructorDocBtn = document.getElementById('viewInstructorDoc');
            const viewCompletionDocBtn = document.getElementById('viewCompletionDoc');
            
            viewInstructorDocBtn.disabled = !student.documentoInstructor;
            viewCompletionDocBtn.disabled = !student.documentoFinalizacion;
            
            // Inicializar datepickers
            flatpickr("#startDate, #endDate", {
                dateFormat: "d/m/Y",
                locale: "es",
                allowInput: true
            });
            
            // Mostrar el modal
            const editModal = new bootstrap.Modal(document.getElementById('editStudentModal'));
            editModal.show();
            
            // Inicializar Select2 en todos los selects DESPUÉS de que el modal esté visible
            setTimeout(() => {
                $('#studentCareer, #studentCampus, #practiceState, #tracking1, #partialEvaluation, #tracking2, #progressReview, #instructorEvaluation, #examAssignment').select2({
                    theme: 'bootstrap-5',
                    width: '100%',
                    dropdownParent: $('#editStudentModal')
                });
            }, 300);
        }

        // Función para preparar el modal de agregar estudiante
        function prepareAddStudentModal() {
            // Llenar selects de carrera y sede
            fillSelectOptions(document.getElementById('newStudentCareer'), carreras, carreras[0]);
            fillSelectOptions(document.getElementById('newStudentCampus'), sedes, sedes[0]);
            
            // Establecer valores por defecto
            document.getElementById('newPracticeSupervisor').value = obtenerEncargadoPractica(carreras[0], sedes[0]);
            document.getElementById('newPracticeState').value = 'no-comienza';
            document.getElementById('newTracking1').value = 'no-comienza';
            document.getElementById('newPartialEvaluation').value = 'excelente';
            document.getElementById('newTracking2').value = 'no-comienza';
            document.getElementById('newProgressReview').value = 'excelente';
            document.getElementById('newInstructorEvaluation').value = 'excelente';
            document.getElementById('newExamAssignment').value = 'no-comienza';
            document.getElementById('newFinalGrade').value = '4.0';
            
            // Inicializar flatpickr en los campos de fecha
            flatpickr("#newStartDate, #newEndDate", {
                dateFormat: "d/m/Y",
                locale: "es",
                allowInput: true
            });
            
            // Mostrar el modal
            const addModal = new bootstrap.Modal(document.getElementById('addStudentModal'));
            addModal.show();
            
            // Inicializar Select2 en todos los selects DESPUÉS de que el modal esté visible
            setTimeout(() => {
                $('#newStudentCareer, #newStudentCampus, #newPracticeState, #newTracking1, #newPartialEvaluation, #newTracking2, #newProgressReview, #newInstructorEvaluation, #newExamAssignment').select2({
                    theme: 'bootstrap-5',
                    width: '100%',
                    dropdownParent: $('#addStudentModal')
                });
            }, 300);
        }

        // Función para guardar los cambios de un estudiante
        function saveStudentChanges(form) {
            const studentId = parseInt(document.getElementById('studentId').value);
            const studentIndex = studentsData.findIndex(s => s.id === studentId);
            
            if (studentIndex !== -1) {
                // Obtener la nota final y asegurarse de que esté dentro del rango
                let notaFinal = parseFloat(document.getElementById('finalGrade').value);
                notaFinal = Math.max(1.0, Math.min(7.0, notaFinal));
                
                const carrera = document.getElementById('studentCareer').value;
                const sede = document.getElementById('studentCampus').value;
                
                // Actualizar datos del estudiante
                studentsData[studentIndex] = {
                    ...studentsData[studentIndex],
                    nombre: document.getElementById('studentName').value,
                    rut: document.getElementById('studentRut').value,
                    carrera: carrera,
                    sede: sede,
                    encargadoPractica: obtenerEncargadoPractica(carrera, sede),
                    centroPractica: document.getElementById('practiceCenter').value,
                    instructor: document.getElementById('practiceInstructor').value,
                    fechaInicio: document.getElementById('startDate').value,
                    fechaTermino: document.getElementById('endDate').value,
                    seguimiento1: document.getElementById('tracking1').value,
                    evaluacionParcial: document.getElementById('partialEvaluation').value,
                    seguimiento2: document.getElementById('tracking2').value,
                    revisionAvance: document.getElementById('progressReview').value,
                    evaluacionInstructor: document.getElementById('instructorEvaluation').value,
                    finalizacionPractica: document.getElementById('practiceState').value,
                    asignacionHoraExamen: document.getElementById('examAssignment').value,
                    notaFinal: notaFinal
                };
                
                // Aquí manejaríamos la lógica para guardar archivos
                const instructorDoc = document.getElementById('instructorDoc').files[0];
                const completionDoc = document.getElementById('completionDoc').files[0];
                
                if (instructorDoc) {
                    studentsData[studentIndex].documentoInstructor = true;
                }
                
                if (completionDoc) {
                    studentsData[studentIndex].documentoFinalizacion = true;
                }
                
                // Guardar en localStorage
                saveToLocalStorage();
                
                // Actualizar interfaz
                updateStatistics();
                renderStudentsList();
                
                // Mostrar mensaje de éxito
                showAlert('Información del estudiante actualizada correctamente', 'success');
                
                return true;
            } else {
                showAlert('Error al actualizar la información del estudiante', 'danger');
                return false;
            }
        }

        // Función para agregar un nuevo estudiante
        function addNewStudent(form) {
            const newId = studentsData.length > 0 ? Math.max(...studentsData.map(s => s.id)) + 1 : 0;
            
            const carrera = document.getElementById('newStudentCareer').value;
            const sede = document.getElementById('newStudentCampus').value;
            let notaFinal = parseFloat(document.getElementById('newFinalGrade').value);
            notaFinal = Math.max(1.0, Math.min(7.0, notaFinal));
            
            const newStudent = {
                id: newId,
                nombre: document.getElementById('newStudentName').value,
                rut: document.getElementById('newStudentRut').value,
                carrera: carrera,
                sede: sede,
                encargadoPractica: obtenerEncargadoPractica(carrera, sede),
                centroPractica: document.getElementById('newPracticeCenter').value,
                instructor: document.getElementById('newPracticeInstructor').value,
                fechaInicio: document.getElementById('newStartDate').value,
                fechaTermino: document.getElementById('newEndDate').value,
                seguimiento1: document.getElementById('newTracking1').value,
                evaluacionParcial: document.getElementById('newPartialEvaluation').value,
                seguimiento2: document.getElementById('newTracking2').value,
                revisionAvance: document.getElementById('newProgressReview').value,
                evaluacionInstructor: document.getElementById('newInstructorEvaluation').value,
                documentoInstructor: false,
                finalizacionPractica: document.getElementById('newPracticeState').value,
                documentoFinalizacion: false,
                asignacionHoraExamen: document.getElementById('newExamAssignment').value,
                notaFinal: notaFinal
            };
            
            studentsData.push(newStudent);
            
            // Guardar en localStorage
            saveToLocalStorage();
            
            // Actualizar interfaz
            updateStatistics();
            renderStudentsList();
            
            // Mostrar mensaje de éxito
            showAlert('Estudiante agregado correctamente', 'success');
            
            return true;
        }

        // Función para eliminar un estudiante
        function deleteStudent(studentId) {
            const studentIndex = studentsData.findIndex(s => s.id === studentId);
            
            if (studentIndex !== -1) {
                // Eliminar el estudiante
                studentsData.splice(studentIndex, 1);
                
                // Reasignar IDs para mantener la secuencia
                studentsData.forEach((student, index) => {
                    student.id = index;
                });
                
                // Guardar en localStorage
                saveToLocalStorage();
                
                // Actualizar interfaz
                updateStatistics();
                renderStudentsList();
                
                // Mostrar mensaje de éxito
                showAlert('Estudiante eliminado correctamente', 'success');
                
                return true;
            } else {
                showAlert('Error al eliminar el estudiante', 'danger');
                return false;
            }
        }

        // Función para mostrar el modal de confirmación de eliminación
        function showDeleteConfirmationModal(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;
            
            studentIdToDelete = studentId;
            document.getElementById('studentToDeleteName').textContent = student.nombre;
            
            const deleteConfirmModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            deleteConfirmModal.show();
        }

        // Función para guardar en localStorage
        function saveToLocalStorage() {
            const dataToSave = studentsData.map(student => ({
                nombre: student.nombre,
                rut: student.rut,
                carrera: student.carrera,
                sede: student.sede,
                encargadoPractica: student.encargadoPractica,
                centroPractica: student.centroPractica,
                instructor: student.instructor,
                fechaInicio: student.fechaInicio,
                fechaTermino: student.fechaTermino,
                seguimiento1: student.seguimiento1,
                evaluacionParcial: student.evaluacionParcial,
                seguimiento2: student.seguimiento2,
                revisionAvance: student.revisionAvance,
                evaluacionInstructor: student.evaluacionInstructor,
                finalizacionPractica: student.finalizacionPractica,
                asignacionHoraExamen: student.asignacionHoraExamen,
                notaFinal: student.notaFinal
            }));
            
            localStorage.setItem('datosPracticas', JSON.stringify(dataToSave));
        }

        // Función para exportar a Excel
        function exportToExcel() {
            // Crear un array con los datos a exportar
            const exportData = [
                ['Nombre', 'RUT', 'Carrera', 'Sede', 'Encargado práctica', 'Centro de práctica', 
                'Instructor', 'Fecha Inicio', 'Fecha Término', 'Seguimiento 1', 'Evaluación parcial', 
                'Seguimiento 2', 'Revisión avance', 'Evaluación instructor', 'Finalización práctica', 
                'Asignación hora examen', 'Nota Final']
            ];
            
            studentsData.forEach(student => {
                exportData.push([
                    student.nombre,
                    student.rut,
                    student.carrera,
                    student.sede,
                    student.encargadoPractica,
                    student.centroPractica,
                    student.instructor,
                    student.fechaInicio,
                    student.fechaTermino,
                    student.seguimiento1 === 'no-comienza' ? 'Pendiente' : 
                        student.seguimiento1 === 'en-proceso' ? 'En proceso' : 'Completado',
                    student.evaluacionParcial.charAt(0).toUpperCase() + student.evaluacionParcial.slice(1),
                    student.seguimiento2 === 'no-comienza' ? 'Pendiente' : 
                        student.seguimiento2 === 'en-proceso' ? 'En proceso' : 'Completado',
                    student.revisionAvance.charAt(0).toUpperCase() + student.revisionAvance.slice(1),
                    student.evaluacionInstructor.charAt(0).toUpperCase() + student.evaluacionInstructor.slice(1),
                    student.finalizacionPractica === 'no-comienza' ? 'Pendiente' : 
                        student.finalizacionPractica === 'en-proceso' ? 'En proceso' : 'Completado',
                    student.asignacionHoraExamen === 'no-comienza' ? 'Pendiente' : 
                        student.asignacionHoraExamen === 'en-proceso' ? 'En proceso' : 'Completado',
                    student.notaFinal.toFixed(1)
                ]);
            });
            
            // Crear workbook y worksheet
            const ws = XLSX.utils.aoa_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Seguimiento Prácticas");
            
            // Guardar archivo
            XLSX.writeFile(wb, "seguimiento_practicas_ingenieria.xlsx");
            
            showAlert('Datos exportados correctamente a Excel', 'success');
        }
        
        // Función para obtener datos para gráficos
        function getReportData() {
            // Datos para gráfico de estado
            const statusData = {
                labels: ['Pendiente', 'En proceso', 'Completada'],
                data: [0, 0, 0]
            };
            
            // Datos para gráfico de sedes
            const campusData = {
                labels: [...sedes],
                data: Array(sedes.length).fill(0)
            };
            
            // Datos para gráfico de carreras
            const careerData = {
                labels: [...carreras],
                data: Array(carreras.length).fill(0)
            };
            
            // Datos para gráfico de evaluación
            const evaluationData = {
                labels: ['Excelente', 'Bien', 'Suficiente', 'Deficiente', 'Malo'],
                data: [0, 0, 0, 0, 0]
            };
            
            // Datos para gráfico de notas
            const gradesData = {
                labels: ['1.0-1.9', '2.0-2.9', '3.0-3.9', '4.0-4.9', '5.0-5.9', '6.0-7.0'],
                data: [0, 0, 0, 0, 0, 0]
            };
            
            // Estadísticas generales
            const stats = {
                total: studentsData.length,
                avgGrade: 0,
                totalGradeSum: 0,
                maxGrade: 0,
                minGrade: 7.0,
                approvalRate: 0
            };
            
            // Recopilar datos
            studentsData.forEach(student => {
                // Datos de estado
                if (student.finalizacionPractica === 'no-comienza') {
                    statusData.data[0]++;
                } else if (student.finalizacionPractica === 'en-proceso') {
                    statusData.data[1]++;
                } else {
                    statusData.data[2]++;
                }
                
                // Datos de sede
                const campusIndex = sedes.indexOf(student.sede);
                if (campusIndex !== -1) {
                    campusData.data[campusIndex]++;
                }
                
                // Datos de carrera
                const careerIndex = carreras.indexOf(student.carrera);
                if (careerIndex !== -1) {
                    careerData.data[careerIndex]++;
                }
                
                // Datos de evaluación
                const evalMap = {
                    'excelente': 0,
                    'bien': 1,
                    'suficiente': 2,
                    'deficiente': 3,
                    'malo': 4
                };
                const evalIndex = evalMap[student.evaluacionInstructor] || 0;
                evaluationData.data[evalIndex]++;
                
                // Datos de notas
                const grade = parseFloat(student.notaFinal);
                if (grade < 2.0) {
                    gradesData.data[0]++;
                } else if (grade < 3.0) {
                    gradesData.data[1]++;
                } else if (grade < 4.0) {
                    gradesData.data[2]++;
                } else if (grade < 5.0) {
                    gradesData.data[3]++;
                } else if (grade < 6.0) {
                    gradesData.data[4]++;
                } else {
                    gradesData.data[5]++;
                }
                
                // Estadísticas de notas
                stats.totalGradeSum += grade;
                stats.maxGrade = Math.max(stats.maxGrade, grade);
                stats.minGrade = Math.min(stats.minGrade, grade);
                if (grade >= 4.0) {
                    stats.approvalRate++;
                }
            });
            
            // Calcular promedio
            stats.avgGrade = stats.total > 0 ? stats.totalGradeSum / stats.total : 0;
            stats.approvalRate = stats.total > 0 ? (stats.approvalRate / stats.total) * 100 : 0;
            
            return {
                statusData,
                campusData,
                careerData,
                evaluationData,
                gradesData,
                stats
            };
        }
        
        // Función para crear gráficos de vista previa
        function createPreviewCharts() {
            const reportData = getReportData();
            
            // Actualizar fecha del informe
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('es-ES');
            
            // Gráfico de Estado
            if (statusChart) statusChart.destroy();
            const statusCtx = document.getElementById('previewStatusChart').getContext('2d');
            statusChart = new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: reportData.statusData.labels,
                    datasets: [{
                        data: reportData.statusData.data,
                        backgroundColor: ['#dc3545', '#ffc107', '#28a745']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Gráfico de Sedes
            if (campusChart) campusChart.destroy();
            const campusCtx = document.getElementById('previewCampusChart').getContext('2d');
            campusChart = new Chart(campusCtx, {
                type: 'doughnut',
                data: {
                    labels: reportData.campusData.labels,
                    datasets: [{
                        data: reportData.campusData.data,
                        backgroundColor: [
                            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Gráfico de Carreras
            if (careerChart) careerChart.destroy();
            const careerCtx = document.getElementById('previewCareerChart').getContext('2d');
            careerChart = new Chart(careerCtx, {
                type: 'bar',
                data: {
                    labels: reportData.careerData.labels.map(c => c.substring(0, 25) + '...'),
                    datasets: [{
                        label: 'Estudiantes por carrera',
                        data: reportData.careerData.data,
                        backgroundColor: '#4e73df'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
            
            // Gráfico de Evaluación
            if (evaluationChart) evaluationChart.destroy();
            const evaluationCtx = document.getElementById('previewEvaluationChart').getContext('2d');
            evaluationChart = new Chart(evaluationCtx, {
                type: 'polarArea',
                data: {
                    labels: reportData.evaluationData.labels,
                    datasets: [{
                        data: reportData.evaluationData.data,
                        backgroundColor: [
                            '#28a745', '#17a2b8', '#ffc107', '#fd7e14', '#dc3545'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Gráfico de Notas
            if (gradesChart) gradesChart.destroy();
            const gradesCtx = document.getElementById('previewGradesChart').getContext('2d');
            gradesChart = new Chart(gradesCtx, {
                type: 'bar',
                data: {
                    labels: reportData.gradesData.labels,
                    datasets: [{
                        label: 'Distribución de notas',
                        data: reportData.gradesData.data,
                        backgroundColor: [
                            '#dc3545', '#dc3545', '#ffc107', '#28a745', '#28a745', '#28a745'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
            
            // Actualizar estadísticas
            const statsContent = document.getElementById('previewStatsContent');
            statsContent.innerHTML = `
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <th>Total Estudiantes</th>
                                <td>${reportData.stats.total}</td>
                            </tr>
                            <tr>
                                <th>Nota Promedio</th>
                                <td>${reportData.stats.avgGrade.toFixed(1)}</td>
                            </tr>
                            <tr>
                                <th>Nota Máxima</th>
                                <td>${reportData.stats.maxGrade.toFixed(1)}</td>
                            </tr>
                            <tr>
                                <th>Nota Mínima</th>
                                <td>${reportData.stats.minGrade.toFixed(1)}</td>
                            </tr>
                            <tr>
                                <th>Tasa de Aprobación</th>
                                <td>${reportData.stats.approvalRate.toFixed(1)}%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Función para generar el informe PDF con gráficos
        function generateReport() {
            // Primero mostrar vista previa con gráficos
            createPreviewCharts();
            const previewModal = new bootstrap.Modal(document.getElementById('reportPreviewModal'));
            previewModal.show();
        }
        
        // Función para generar el PDF final con gráficos
        async function generateFinalPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const reportData = getReportData();
            
            // Título
            doc.setFontSize(20);
            doc.setTextColor(0, 32, 78); // Color primario
            doc.text('Informe de Seguimiento de Prácticas', 105, 20, { align: 'center' });
            
            doc.setFontSize(16);
            doc.text('Facultad de Ingenierías, Tecnologías e Innovación', 105, 30, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 105, 40, { align: 'center' });
            
            // Estadísticas generales
            doc.setFontSize(14);
            doc.setTextColor(0, 32, 78);
            doc.text('Estadísticas Generales', 20, 55);
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(`Total de estudiantes en prácticas: ${reportData.stats.total}`, 20, 65);
            doc.text(`Prácticas en proceso: ${reportData.statusData.data[1]} (${Math.round((reportData.statusData.data[1]/reportData.stats.total || 0) * 100)}%)`, 20, 71);
            doc.text(`Prácticas completadas: ${reportData.statusData.data[2]} (${Math.round((reportData.statusData.data[2]/reportData.stats.total || 0) * 100)}%)`, 20, 77);
            doc.text(`Prácticas pendientes: ${reportData.statusData.data[0]} (${Math.round((reportData.statusData.data[0]/reportData.stats.total || 0) * 100)}%)`, 20, 83);
            doc.text(`Nota promedio: ${reportData.stats.avgGrade.toFixed(1)}`, 20, 89);
            doc.text(`Nota máxima: ${reportData.stats.maxGrade.toFixed(1)}`, 20, 95);
            doc.text(`Nota mínima: ${reportData.stats.minGrade.toFixed(1)}`, 20, 101);
            doc.text(`Tasa de aprobación: ${reportData.stats.approvalRate.toFixed(1)}%`, 20, 107);
            
            // Capturar gráficos como imágenes
            const statusCanvas = document.getElementById('previewStatusChart');
            const campusCanvas = document.getElementById('previewCampusChart');
            const careerCanvas = document.getElementById('previewCareerChart');
            const evaluationCanvas = document.getElementById('previewEvaluationChart');
            const gradesCanvas = document.getElementById('previewGradesChart');
            
            // Agregar gráficos al PDF
            let yPos = 115;
            
            // Gráfico de estado
            doc.setFontSize(14);
            doc.setTextColor(0, 32, 78);
            doc.text('Distribución por Estado', 20, yPos);
            yPos += 10;
            
            const statusImg = statusCanvas.toDataURL('image/png');
            doc.addImage(statusImg, 'PNG', 20, yPos, 80, 60);
            
            // Gráfico de sedes
            doc.text('Distribución por Sedes', 110, yPos - 10);
            const campusImg = campusCanvas.toDataURL('image/png');
            doc.addImage(campusImg, 'PNG', 110, yPos, 80, 60);
            
            // Nueva página para más gráficos
            doc.addPage();
            yPos = 20;
            
            // Gráfico de carreras
            doc.setFontSize(14);
            doc.setTextColor(0, 32, 78);
            doc.text('Distribución por Carreras', 105, yPos, { align: 'center' });
            yPos += 10;
            
            const careerImg = careerCanvas.toDataURL('image/png');
            doc.addImage(careerImg, 'PNG', 15, yPos, 180, 70);
            yPos += 80;
            
            // Gráfico de evaluación
            doc.text('Evaluación del Instructor', 20, yPos);
            const evaluationImg = evaluationCanvas.toDataURL('image/png');
            doc.addImage(evaluationImg, 'PNG', 20, yPos + 10, 80, 60);
            
            // Gráfico de notas
            doc.text('Distribución de Notas Finales', 110, yPos);
            const gradesImg = gradesCanvas.toDataURL('image/png');
            doc.addImage(gradesImg, 'PNG', 110, yPos + 10, 80, 60);
            
            // Lista de estudiantes
            doc.addPage();
            
            doc.setFontSize(16);
            doc.setTextColor(0, 32, 78);
            doc.text('Listado de Estudiantes en Prácticas', 105, 20, { align: 'center' });
            
            // Tabla de estudiantes
            const tableData = [];
            const tableColumns = ['Nombre', 'RUT', 'Carrera', 'Sede', 'Estado', 'Nota'];
            
            studentsData.forEach(student => {
                let estado = 'Pendiente';
                if (student.finalizacionPractica === 'en-proceso') {
                    estado = 'En proceso';
                } else if (student.finalizacionPractica === 'completada') {
                    estado = 'Completada';
                }
                
                tableData.push([
                    student.nombre,
                    student.rut,
                    student.carrera.length > 25 ? student.carrera.substring(0, 25) + '...' : student.carrera,
                    student.sede,
                    estado,
                    student.notaFinal.toFixed(1)
                ]);
            });
            
            // Simple table implementation
            yPos = 30;
            const cellWidth = [45, 25, 50, 20, 25, 15];
            const cellPadding = 5;
            const lineHeight = 7;
            
            // Table header
            doc.setFillColor(0, 32, 78);
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            
            let xPos = 10;
            tableColumns.forEach((column, index) => {
                doc.rect(xPos, yPos, cellWidth[index], lineHeight, 'F');
                doc.text(column, xPos + cellPadding, yPos + 5);
                xPos += cellWidth[index];
            });
            
            // Table rows
            doc.setTextColor(0, 0, 0);
            yPos += lineHeight;
            
            tableData.forEach((row, rowIndex) => {
                // Add a new page if needed
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Alternate row colors
                if (rowIndex % 2 === 0) {
                    doc.setFillColor(240, 240, 240);
                    xPos = 10;
                    tableColumns.forEach((column, index) => {
                        doc.rect(xPos, yPos, cellWidth[index], lineHeight, 'F');
                        xPos += cellWidth[index];
                    });
                }
                
                // Cell content
                xPos = 10;
                row.forEach((cell, cellIndex) => {
                    doc.text(cell.toString(), xPos + cellPadding, yPos + 5);
                    xPos += cellWidth[cellIndex];
                });
                
                yPos += lineHeight;
            });
            
            // Guardar el archivo
            doc.save('informe_practicas_ingenieria.pdf');
            
            showAlert('Informe generado correctamente', 'success');
            
            // Cerrar el modal de vista previa
            const previewModal = bootstrap.Modal.getInstance(document.getElementById('reportPreviewModal'));
            if (previewModal) {
                previewModal.hide();
            }
        }

        // Función para mostrar alertas
        function showAlert(message, type) {
            const alertHTML = `
                <div class="alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" 
                    role="alert" style="z-index: 1050;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i> ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                </div>
            `;
            $('body').append(alertHTML);
            setTimeout(() => {
                $('.alert').alert('close');
            }, 3000);
        }

        // Inicialización cuando el DOM esté listo
        $(document).ready(function() {
            // Verificar si el usuario está logueado
            if (sessionStorage.getItem('loggedIn') !== 'true') {
                // Por ahora no requerimos login para desarrollo
                sessionStorage.setItem('loggedIn', 'true');
                // window.location.href = 'index.html';
                // return;
            }
            
            // Cargar datos de estudiantes
            loadStudentsData();
            
            // Inicializar tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Inicializar datepickers
            flatpickr(".datepicker", {
                dateFormat: "d/m/Y",
                locale: "es",
                allowInput: true
            });
            
            // Event listeners
            
            // Filtro de búsqueda
            $('#searchStudent').on('input', function() {
                activeFilters.search = $(this).val().trim();
                currentPage = 1;
                renderStudentsList();
            });
            
            // Filtro por carrera
            $('#filterCareer').on('change', function() {
                activeFilters.career = $(this).val();
                currentPage = 1;
                renderStudentsList();
                
                // Actualizar etiquetas de filtros activos
                updateActiveFiltersDisplay();
            });
            
            // Filtro por estado
            $('#filterStatus').on('change', function() {
                activeFilters.status = $(this).val();
                currentPage = 1;
                renderStudentsList();
                
                // Actualizar etiquetas de filtros activos
                updateActiveFiltersDisplay();
            });
            
            // Función para actualizar etiquetas de filtros activos
            function updateActiveFiltersDisplay() {
                const activeFiltersContainer = document.getElementById('activeFilters');
                activeFiltersContainer.innerHTML = '';
                
                if (activeFilters.career) {
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `Carrera: ${activeFilters.career} <i class="fas fa-times close"></i>`;
                    tag.querySelector('.close').addEventListener('click', () => {
                        $('#filterCareer').val('').trigger('change');
                    });
                    activeFiltersContainer.appendChild(tag);
                }
                
                if (activeFilters.status) {
                    let statusText = 'Pendiente';
                    if (activeFilters.status === 'en-proceso') statusText = 'En proceso';
                    if (activeFilters.status === 'completada') statusText = 'Completada';
                    
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `Estado: ${statusText} <i class="fas fa-times close"></i>`;
                    tag.querySelector('.close').addEventListener('click', () => {
                        $('#filterStatus').val('').trigger('change');
                    });
                    activeFiltersContainer.appendChild(tag);
                }
            }
            
            // Editar estudiante
            $(document).on('click', '.edit-student', function() {
                const studentId = parseInt($(this).data('id'));
                fillEditModal(studentId);
            });
            
            // Cambio en carrera o sede para actualizar encargado práctica (modal edición)
            $(document).on('change', '#studentCareer, #studentCampus', function() {
                const carrera = $('#studentCareer').val();
                const sede = $('#studentCampus').val();
                const encargado = obtenerEncargadoPractica(carrera, sede);
                $('#practiceSupervisor').val(encargado);
            });
            
            // Cambio en carrera o sede para actualizar encargado práctica (modal agregar)
            $(document).on('change', '#newStudentCareer, #newStudentCampus', function() {
                const carrera = $('#newStudentCareer').val();
                const sede = $('#newStudentCampus').val();
                const encargado = obtenerEncargadoPractica(carrera, sede);
                $('#newPracticeSupervisor').val(encargado);
            });
            
            // Subir documento
            $(document).on('click', '.upload-document', function() {
                const studentId = parseInt($(this).data('id'));
                const docType = $(this).data('type');
                
                // Simular clic en el input file correspondiente en el modal
                fillEditModal(studentId);
                
                // Una vez cargado el modal, hacer foco en el campo correspondiente
                $('#editStudentModal').on('shown.bs.modal', function() {
                    if (docType === 'instructor') {
                        $('#instructorDoc').focus();
                    } else {
                        $('#completionDoc').focus();
                    }
                });
            });
            
            // Botón para eliminar estudiante
            $(document).on('click', '#deleteStudentBtn', function() {
                const studentId = parseInt($('#studentId').val());
                showDeleteConfirmationModal(studentId);
                $('#editStudentModal').modal('hide');
            });
            
            // Confirmar eliminación de estudiante
            $('#confirmDeleteBtn').on('click', function() {
                if (studentIdToDelete !== null) {
                    deleteStudent(studentIdToDelete);
                    $('#deleteConfirmModal').modal('hide');
                    studentIdToDelete = null;
                }
            });
            
            // Envío del formulario de edición
            $('#editStudentForm').on('submit', function(e) {
                e.preventDefault();
                if (saveStudentChanges(this)) {
                    $('#editStudentModal').modal('hide');
                }
            });
            
            // Botón para agregar estudiante
            $('#addStudentBtn').on('click', function() {
                prepareAddStudentModal();
            });
            
            // Envío del formulario para agregar estudiante
            $('#addStudentForm').on('submit', function(e) {
                e.preventDefault();
                if (addNewStudent(this)) {
                    $('#addStudentModal').modal('hide');
                }
            });
            
            // Botón para exportar a Excel
            $('#exportExcelBtn').on('click', function() {
                exportToExcel();
            });
            
            // Botón para generar informe
            $('#generateReportBtn').on('click', function() {
                generateReport();
            });
            
            // Botón para generar PDF final desde la vista previa
            $('#generateFinalReportBtn').on('click', function() {
                generateFinalPDF();
            });
            
            // Botón para cerrar sesión
            $('#logoutBtn').on('click', function() {
                sessionStorage.removeItem('loggedIn');
                window.location.href = 'index.html';
            });
            
            // Botón para volver al menú principal
            $('#volverPrincipal, .navbar-brand').on('click', function(e) {
                e.preventDefault();
                window.location.href = 'index.html';
            });
        });
    </script>
</body>
</html>
