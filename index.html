<iframe id="practicasIframe" style="width:100%; height:800px; border:none;" srcdoc="
<!DOCTYPE html>
<html lang='es'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Seguimiento de Prácticas Laborales - Facultad de Ingenierías, Tecnologías e Innovación</title>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css' rel='stylesheet'>
    <style>
        body { padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .dataTables_wrapper { padding: 20px 0; }
        .container-fluid { max-width: 100%; overflow-x: auto; }
        .estado-no-comienza { background-color: #ffcccc; color: #990000; }
        .estado-en-proceso { background-color: #ffffcc; color: #999900; }
        .estado-completada { background-color: #ccffcc; color: #009900; }
    </style>
</head>
<body>
    <div class='container-fluid'>
        <h1 class='text-center mb-4'>Seguimiento de Prácticas Laborales - Facultad de Ingenierías, Tecnologías e Innovación</h1>
        <table id='seguimientoPracticas' class='table table-striped table-bordered'>
            <thead>
                <tr>
                    <th>Nombre y Apellidos</th>
                    <th>RUT</th>
                    <th>Carrera</th>
                    <th>Fecha de Inicio</th>
                    <th>Fecha de Término</th>
                    <th>Seguimiento semana 2</th>
                    <th>Evaluación parcial</th>
                    <th>Seguimiento mensual 1</th>
                    <th>Revisión medio término</th>
                    <th>Seguimiento mensual 2</th>
                    <th>Preparación cierre</th>
                    <th>Finalización práctica</th>
                    <th>Asignación hora examen título</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se generarán dinámicamente aquí -->
            </tbody>
        </table>
        <div class='text-center mt-3'>
            <button id='exportButton' class='btn btn-primary'>Exportar a Excel</button>
        </div>
    </div>

    <script src='https://code.jquery.com/jquery-3.6.0.min.js'></script>
    <script src='https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js'></script>
    <script src='https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js'></script>
    <script src='https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js'></script>
    <script src='https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/flatpickr'></script>
    <script src='https://npmcdn.com/flatpickr/dist/l10n/es.js'></script>

    <script>
        const carreras = [
            'Técnico en Enfermería', 'Técnico en Administración', 'Técnico en Informática',
            'Técnico en Contabilidad', 'Técnico en Electricidad', 'Técnico en Mecánica Automotriz',
            'Técnico en Construcción', 'Técnico en Diseño Gráfico', 'Técnico en Gastronomía',
            'Técnico en Turismo'
        ];

        function generarRUTChileno() {
            let rut = Math.floor(Math.random() * 30000000) + 5000000;
            let dv = 11 - (rut % 11);
            if (dv === 11) dv = 0;
            if (dv === 10) dv = 'K';
            return rut + '-' + dv;
        }

        function generarNombreApellido() {
            const nombres = ['Juan', 'María', 'Pedro', 'Ana', 'Luis', 'Carmen', 'José', 'Isabel', 'Francisco', 'Sofía'];
            const apellidos = ['González', 'Rodríguez', 'Fernández', 'López', 'Martínez', 'Pérez', 'Gómez', 'Sánchez', 'Díaz', 'Torres'];
            return nombres[Math.floor(Math.random() * nombres.length)] + ' ' + 
                   apellidos[Math.floor(Math.random() * apellidos.length)] + ' ' + 
                   apellidos[Math.floor(Math.random() * apellidos.length)];
        }

        function crearSelectEstado() {
            return `<select class='form-select estado-select'>
                <option value='no-comienza' class='estado-no-comienza'>No comienza</option>
                <option value='en-proceso' class='estado-en-proceso'>En proceso</option>
                <option value='completada' class='estado-completada'>Completada</option>
            </select>`;
        }

        function generarFilas() {
            let tbody = $('#seguimientoPracticas tbody');
            for (let i = 0; i < 100; i++) {
                tbody.append(`
                    <tr>
                        <td><input type='text' class='form-control' value='${generarNombreApellido()}'></td>
                        <td><input type='text' class='form-control' value='${generarRUTChileno()}'></td>
                        <td><input type='text' class='form-control' value='${carreras[Math.floor(Math.random() * carreras.length)]}'></td>
                        <td><input type='text' class='form-control datepicker'></td>
                        <td><input type='text' class='form-control datepicker'></td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                        <td>${crearSelectEstado()}</td>
                    </tr>
                `);
            }
        }

        $(document).ready(function() {
            generarFilas();

            flatpickr.localize(flatpickr.l10ns.es);
            
            flatpickr('.datepicker', {
                dateFormat: 'd-m-Y',
                minDate: 'today',
                maxDate: '31-12-2025',
                locale: 'es'
            });

            let table = $('#seguimientoPracticas').DataTable({
                pageLength: 10,
                lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json'
                },
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excel',
                        text: 'Exportar a Excel',
                        filename: 'seguimiento_practicas',
                        exportOptions: {
                            columns: ':visible',
                            format: {
                                body: function (data, row, column, node) {
                                    let $node = $(node);
                                    let $input = $node.find('input');
                                    let $select = $node.find('select');
                                    if ($input.length) {
                                        return $input.val();
                                    } else if ($select.length) {
                                        return $select.val();
                                    }
                                    return data;
                                }
                            }
                        }
                    }
                ],
                responsive: true
            });

            $('#exportButton').on('click', function() {
                table.button('.buttons-excel').trigger();
            });

            // Cambiar el color de fondo de los select según la opción seleccionada
            $(document).on('change', '.estado-select', function() {
                $(this).removeClass('estado-no-comienza estado-en-proceso estado-completada');
                $(this).addClass('estado-' + $(this).val());
            });

            // Ajustar el tamaño del iframe
            window.parent.postMessage({ event: 'resize', height: document.body.scrollHeight }, '*');
        });
    </script>
</body>
</html>
">
</iframe>

<script>
window.addEventListener('message', function(e) {
    if (e.data && e.data.event === 'resize') {
        document.getElementById('practicasIframe').style.height = e.data.height + 'px';
    }
}, false);
</script>
